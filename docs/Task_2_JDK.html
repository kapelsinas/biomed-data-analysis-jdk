<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Jaroslav Rutkovskij, Danielė Stasiūnaitė, Karolis Augustauskas (JDK)" />


<title>Practical No. 2</title>

<script src="site_libs/header-attrs-2.13/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Biomedical data analysis tasks</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Task_2_JDK.html">Task 2</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Practical No. 2</h1>
<h4 class="author">Jaroslav Rutkovskij, Danielė Stasiūnaitė, Karolis Augustauskas (JDK)</h4>
<h4 class="date">3/18/2022</h4>

</div>


<div id="duomenų-paruošimas" class="section level1">
<h1>Duomenų paruošimas</h1>
<div id="duomenų-paruošimo-žingsniai" class="section level2">
<h2>Duomenų paruošimo žingsniai</h2>
<p><strong>1. Pasiruoškite sau paskirtus sample-key failus (apvalydami reikšmes).</strong><br />
Pateiktoje <em>sample-key</em> lentelėje nebuvo aptikta anotacijos, gramatikos klaidų. Stulpelių pavadinimai buvo pateikti mažosiomis raidėmis, todėl jie nebuvo koreguojami. Taip pat buvo tikrinami skaitinės informacijos rėžiai, tačiau visa informacija buvo pateikta korektiškai ir teisingai, todėl papildomos modifikacijos nebuvo atliekamos.</p>
<p><strong>2. Nuskaitykite parsisiųstus idat failus į “RGChannelSet” tipo objektą.</strong><br />
Idat failų nuskaitymui buvo sėkmingai panaudota <em>read.metharray.exp()</em> funkcija iš R <em>minfi</em> bibliotekos, kuri buvo įkelta prieš atliekant duomenų valymą (R programos Preparations bloke).</p>
<pre class="r"><code>rgSet &lt;- read.metharray.exp(base = &quot;IDATS&quot;)</code></pre>
<p><strong>3. Gaukite “detection p-value” kiekvienam DNR modifikacijos įverčiui.</strong><br />
<strong><em>Detection p-value</em></strong> matrica kiekvienam DNR modifikacijos įverčiui gauta, naudojant <em>detectionP()</em> funkciją iš <em>minfi</em> bibliotekos.</p>
<p>Patikrinus, ar yra p-verčių didesnių už 0.01, tokių verčių nebuvo aptikta.<br />
<strong>Iš RGChannelSet objekto išmeskite visus mėginius (stulpelius), kurie turi</strong> <strong>daugiau nei 1% “blogų” <em>detection p</em> reikšmių.</strong></p>
<pre class="r"><code>rgSet &lt;- rgSet[, keep]
data &lt;- data[keep,]
detP &lt;- detP[, keep]
NROW(rgSet)</code></pre>
<pre><code>## [1] 1051815</code></pre>
<p><strong>4. Normalizuokite savo duomenis, naudojant preprocessSWAN(),</strong> <strong>preprocessFunnorm() arba preproccessIllumina() funkcijas iš <em>minfi</em> </strong> <strong>bibliotekos.</strong><br />
Duomenims normalizuoti buvo pasirinkta <em>preprocessFunnorm()</em> funkcija, nes ji buvo naudota <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7607658/">straipsnyje</a> aprašyto tyrimo metu. Atliekant Biomedicininės duomenų analizės užduotis yra siekiama kuo tiksliau atkartoti šiame straipsnyje aprašyto tyrimo metu atliktą statistinę gautų duomenų analizę.</p>
<pre class="r"><code>mSetSq &lt;- preprocessFunnorm(rgSet)
mSetRaw &lt;- preprocessRaw(rgSet)</code></pre>
<p><strong>5. Išmeskite visas genomines pozicijas (eilutes), kurios turi daugiau nei 1%</strong> <strong>“blogų” <em>detection p</em> reikšmių.</strong></p>
<pre class="r"><code># ensure probes are in the same order in the mSetSq and detP objects:
detP &lt;- detP[match(featureNames(mSetSq), rownames(detP)), ]

# remove any probes that have failed in one or more samples:
keep &lt;- rowSums(detP &lt; 0.01) == ncol(mSetSq)
NROW(mSetSq)
table(keep)
##  keep
##  FALSE   TRUE
##  9713    856146
mSetSq &lt;- mSetSq[keep, ]
NROW(mSetSq)</code></pre>
<p><strong>6. Išmeskite genomines pozicijas (eilutes), neturinčias “CG” nukleotidų</strong> <strong>poros (CH) arba esančias šalia DNR polimorfizmų.</strong><br />
Genominės pozicijos, neturinčios “CG” nukleotidų poros, buvo pašalintos, pasinaudojus <em>dropMethylationLoci()</em> funkcija.</p>
<p>Prieš panaudojant <em>dropMethylationLoci()</em> funkciją duomenų matrica turėjo <strong>865859</strong> eilutes. Atlikus genominių pozicijų, neturinčių “CG” nukleotidų poros, filtravimą, buvo paliktos <strong>862927</strong> matricos eilutės - <strong>2932</strong> eilutės buvo pašalintos.</p>
<p><strong>7. Pašalinkite mėginius, kurių nurodyta lytis skiriasi nuo spėjamos lyties.</strong> Straipsnyje aprašyto tyrimo metu buvo tiriamos tik moterys. Pasinaudojus <em>getSex()</em> funkcija, spėjančią žmogaus lytį, kita lytis nebuvo gauta - visiems žmonėms, kurių mėginiai buvo analizuojami, buvo nuspėta moteriška (female (F)) lytis.</p>
<pre class="r"><code>estSex &lt;- getSex(mSetSq, cutoff = -2)
estSex$predictedSex == &#39;F&#39;</code></pre>
<pre><code>##   [1] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
##  [16] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
##  [31] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
##  [46] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
##  [61] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
##  [76] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
##  [91] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [106] TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE TRUE
## [121] TRUE TRUE TRUE TRUE</code></pre>
<p><strong>8. Po duomenų paruošimo iš gauto objekto pasidarykite 3 atskirus objektus:</strong> <strong>pagrindinės modifikacijos įverčių matricos (getBeta()), informacijos apie</strong> <strong>pagrindinės matricos mėginius (stulpelius) (pData()) ir informacijos apie</strong> <strong>pagrindinės matricos pozicijas (eilutes) (getAnnotation()).</strong></p>
<pre class="r"><code>beta &lt;- getBeta(mSetSq)
pData &lt;- pData(mSetSq)
annotation &lt;- getAnnotation(mSetSq)
save(beta, file = &quot;beta.Rdata&quot;)
save(pData, file = &quot;pData.Rdata&quot;)
save(annotation, file = &quot;annotation.Rdata&quot;)</code></pre>
<p><strong>9. Atlikite IAC išskirčių pašalinimą.</strong><br />
Išskirtys pašalintos, remiantis <a href="https://horvath.genetics.ucla.edu/html/CoexpressionNetwork/HumanBrainTranscriptome/Identification%20and%20Removal%20of%20Outlier%20Samples.pdf">šiame dokumente</a> pateiktu procedūros aprašymu.</p>
<pre class="r"><code># # load(&quot;beta.Rdata&quot;)
dat &lt;- beta

IAC &lt;- cor(dat, use = &quot;p&quot;)
hist(IAC, sub = paste(&quot;Mean=&quot;, format(mean(IAC[upper.tri(IAC)]), digits = 3)))</code></pre>
<p><img src="Task_2_JDK_files/figure-html/Task_9_1-1.png" width="672" /></p>
<p>Sukurtoje histogramoje galima matyti, kad prieš atliekant išskirčių šalinimą, vidutinė IAC vertė yra lygi <strong>0.984</strong>. Taip pat histogramoje matomos dvi “uodegos”, esančios kairėje ir dešinėje reikšmių pasiskirstymo pusėse. Tai rodo, jog tarp turimų duomenų gali būti išskirčių.</p>
<pre class="r"><code>meanIAC &lt;- apply(IAC, 2, mean)
sdCorr &lt;- sd(meanIAC)
numbersd &lt;- (meanIAC - mean(meanIAC)) / sdCorr
plot(numbersd)
abline(h = -2)</code></pre>
<p><img src="Task_2_JDK_files/figure-html/Task_9_2-1.png" width="672" /></p>
<p>Tokią pačią išvadą apie išskirtis galima padaryti ir išanalizavus pateiktą sklaidos grafiką (scatter plot). Grafike galima pastebėti, jog esama 6 mėginių, esančių žemiau -2 reikšmės ribos. Pasinaudojus R komandomis buvo nustatyti šių mėginių vardai:</p>
<pre class="r"><code>sdout = -2
outliers = dimnames(dat)[[2]][numbersd &lt; sdout]
outliers</code></pre>
<pre><code>## [1] &quot;GSM4223839_202135260006_R04C01&quot; &quot;GSM4223859_202135260109_R08C01&quot;
## [3] &quot;GSM4223887_202135260065_R03C01&quot; &quot;GSM4223895_202081130066_R02C01&quot;
## [5] &quot;GSM4223901_202081130066_R08C01&quot; &quot;GSM4223917_202128330197_R08C01&quot;</code></pre>
<p>Nustatyti mėginiai buvo pašalinti. Atlikus mėginių šalinimą toliau buvo tikrinama, ar duomenų rinkinyje liko išskirčių. Tas pats procesas buvo kartojamas tol, kol programa pateikdavo mėginių pavadinimus, kuriuose yra išskirčių.</p>
<p>Atlikus 7 iteracijas programa nebepateikė mėginių, kuriuose yra išskirčių, pavadinimų bei sklaidos grafike nebeliko taškų, esančių žemiau -2 reikšmės ribos:</p>
<pre class="r"><code>IAC &lt;- cor(dat8, use = &quot;p&quot;)
hist(IAC, sub = paste(&quot;Mean=&quot;, format(mean(IAC[upper.tri(IAC)]), digits = 3)))</code></pre>
<p><img src="Task_2_JDK_files/figure-html/Task_9_4_plot-1.png" width="672" /></p>
<pre class="r"><code>meanIAC &lt;- apply(IAC, 2, mean)
sdCorr &lt;- sd(meanIAC)
numbersd &lt;- (meanIAC - mean(meanIAC)) / sdCorr
plot(numbersd)
abline(h = -2)</code></pre>
<p><img src="Task_2_JDK_files/figure-html/Task_9_4_plot-2.png" width="672" /></p>
<p>Atlikus 7 iteracijas buvo pašalinti <strong>28</strong> mėginiai. Duomenų rinkinyje liko <strong>96</strong> mėginiai, neturintys išskirčių.</p>
<p><strong>10. Atlikite bent vieną kokybės kontrolės žingsnį.</strong></p>
<pre class="r"><code># rm(list = ls(all.names = TRUE))

# # Įkeliami pData ir annotation objektai: 
# load(&quot;pData.Rdata&quot;)
# load(&quot;annotation.Rdata&quot;)

# Nuskaitomas beta duomenų rinkinys su pašalintomis išskirtimis:
beta_clean &lt;- readRDS(&quot;dat8.Rds&quot;)

pDatf &lt;- as.data.frame(pData)
annotf &lt;- as.data.frame(annotation)
beta_cleandf &lt;- as.data.frame(beta_clean)

clean_pDat &lt;- pDatf[(rownames(pDatf) %in% c(colnames(beta_clean))), ]
save(clean_pDat, file = &quot;clean_pDat.Rdata&quot;)

openSea &lt;- annotf[annotf$Relation_to_Island == &quot;OpenSea&quot;, ]
b_openSea &lt;- rowMeans(beta_cleandf[rownames(openSea), ])

island &lt;- annotf[annotf$Relation_to_Island == &quot;Island&quot;, ]
b_island &lt;- rowMeans(beta_cleandf[rownames(island), ])

n_shore &lt;- annotf[annotf$Relation_to_Island == &quot;N_Shore&quot;, ]
b_n_shore &lt;- rowMeans(beta_cleandf[rownames(n_shore), ])

s_shore &lt;- annotf[annotf$Relation_to_Island == &quot;S_Shore&quot;, ]
b_s_shore &lt;- rowMeans(beta_cleandf[rownames(s_shore), ])

n_shelf &lt;- annotf[annotf$Relation_to_Island == &quot;N_Shelf&quot;, ]
b_n_shelf &lt;- rowMeans(beta_cleandf[rownames(n_shelf), ])

s_shelf &lt;- annotf[annotf$Relation_to_Island == &quot;S_Shelf&quot;, ]
b_s_shelf &lt;- rowMeans(beta_cleandf[rownames(s_shelf), ])

betas_by_group &lt;- c(b_island, b_openSea, b_n_shore,
                    b_s_shore,b_n_shelf, b_s_shelf)

cpg_regions &lt;- c(rep(&quot;Island&quot;, length(b_island)),
                 rep(&quot;OpenSea&quot;, length(b_openSea)),
                 rep(&quot;s_shore&quot;, length(b_s_shore)),
                 rep(&quot;n_shore&quot;, length(b_n_shore)),
                 rep(&quot;n_shelf&quot;, length(b_n_shelf)),
                 rep(&quot;s_shelf&quot;, length(b_s_shelf)))

df &lt;- data.frame(betas_by_group, cpg_regions)
saveRDS(betas_by_group, file = &quot;betas_by_group.Rds&quot;)
saveRDS(cpg_regions, file = &quot;cpg_regions.Rds&quot;)
saveRDS(df, &quot;df.Rds&quot;)</code></pre>
<pre class="r"><code>qc_plot &lt;- ggplot(df, aes(x = betas_by_group, colour = cpg_regions)) +
            labs(title = &quot;Metilintos DNR pasiskirstymas&quot;,
                 x = NULL, y = &quot;Tankis&quot;) +
            geom_density(lwd = 0.8, linetype = 1) +
            xlim(-0.05, 1) +
            theme(plot.title = element_text(hjust = 0.5)) +
            scale_colour_discrete(name = &quot;CpG regionai&quot;)
qc_plot + theme(legend.position = &quot;bottom&quot;)</code></pre>
<p><img src="Task_2_JDK_files/figure-html/Task_10_plot-1.png" width="672" /></p>
<p><strong>11. Užsikrauname išsaugotus paruoštus duomenis.</strong></p>
<pre class="r"><code># load(&quot;beta.Rdata&quot;)
# load(&quot;pData.Rdata&quot;)
# load(&quot;annotation.Rdata&quot;)</code></pre>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
